
TASK:

Create a procedure that logs any update made to the employees table.
Insert a record into emp_update_log(emp_id, old_salary, new_salary, updated_on).

CREATE OR REPLACE PROCEDURE log_salary_update(
  p_emp_id   IN NUMBER,
  p_new_sal  IN NUMBER
) AS
  v_old_sal NUMBER;
BEGIN
  -- Get current salary before update
  SELECT salary INTO v_old_sal
  FROM employees
  WHERE employee_id = p_emp_id;

  -- Update salary
  UPDATE employees
  SET salary = p_new_sal
  WHERE employee_id = p_emp_id;

  -- Insert into log table
  INSERT INTO emp_update_log(emp_id, old_salary, new_salary, updated_on)
  VALUES (p_emp_id, v_old_sal, p_new_sal, SYSDATE);

  DBMS_OUTPUT.PUT_LINE('Salary updated and logged for employee ID: ' || p_emp_id);
EXCEPTION
  WHEN NO_DATA_FOUND THEN
    DBMS_OUTPUT.PUT_LINE('Employee ID not found: ' || p_emp_id);
  WHEN OTHERS THEN
    DBMS_OUTPUT.PUT_LINE('Error: ' || SQLERRM);
END;
/


--To call the procedure

BEGIN
  log_salary_update(101, 7000);
END;
/
